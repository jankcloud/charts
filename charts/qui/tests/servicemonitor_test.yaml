suite: ServiceMonitor tests
templates:
  - templates/servicemonitor.yaml
tests:
  - it: does not render ServiceMonitor by default
    asserts:
      - hasDocuments:
          count: 0

  - it: renders ServiceMonitor when enabled with metrics
    set:
      metrics:
        enabled: true
        path: /metrics
      serviceMonitor:
        enabled: true
        interval: 30s
        scrapeTimeout: 10s
    asserts:
      - isKind:
          of: ServiceMonitor
      - equal:
          path: spec.endpoints[0].port
          value: metrics
      - equal:
          path: spec.endpoints[0].path
          value: /metrics

  - it: does not render ServiceMonitor if metrics are disabled
    set:
      metrics:
        enabled: false
      serviceMonitor:
        enabled: true
    asserts:
      - hasDocuments:
          count: 0
